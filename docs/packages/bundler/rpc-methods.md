---
sidebar_position: 4
title: Stackup bundler RPC methods
sidebar_label: RPC methods
description: This page is a reference for all supported RPC methods in stackup-bundler, Stackup's ERC-4337 open-source infrastructure.
---

# RPC methods

A reference to the supported RPC methods.

## `eth` namespace

All RPC methods listed here are required to be compliant as an ERC-4337 bundler.

---

### Send UserOperation

Used to submit a [UserOperation](../../introduction/erc-4337-overview.md#useroperation) to the mempool. It returns the `userOpHash` if the userOp was accepted otherwise returns an error.

#### Request

```typescript
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "eth_sendUserOperation",
  "params": [
    // UserOperation object
    {
      sender,
      nonce,
      initCode,
      callData,
      callGasLimit,
      verificationGasLimit,
      preVerificationGas,
      maxFeePerGas,
      maxPriorityFeePerGas,
      paymasterAndData,
      signature
    },

    // Supported EntryPoint address
    entryPoint
  ]
}
```

#### Response

```typescript
{
  "jsonrpc": "2.0",
  "id": 1,

  // UserOpHash
  "result": "0x..."
}
```

---

### Estimate UserOperation gas

This method returns estimates for PreVerificationGas, VerificationGas, and CallGasLimit given a UserOperation and EntryPoint address. The signature field and current gas values will not be validated although there should be dummy values in place for the most reliable results (e.g. a signature with the correct length).

#### Request

```typescript
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "eth_estimateUserOperationGas",
  "params": [
    // UserOperation object
    {
      sender,
      nonce,
      initCode,
      callData,
      callGasLimit,
      verificationGasLimit,
      preVerificationGas,
      maxFeePerGas,
      maxPriorityFeePerGas,
      paymasterAndData,
      signature
    },

    // Supported EntryPoint address
    entryPoint
  ]
}
```

#### Response

```typescript
{
  "jsonrpc": "2.0",
  "id": 1,

  // The return values are the hex strings for wei values.
  "result": {
		"PreVerificationGas": "0x..",
		"VerificationGas":    "0x..",
		"CallGasLimit":       "0x..",
	}
}
```

---

### Get UserOperation by hash

Fetches the UserOperation and transaction context based on a given `userOpHash` returned from `eth_sendUserOperation`.

#### Request

```typescript
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "eth_getUserOperationByHash",
  "params": [userOpHash]
}
```

#### Response

The method returns `null` if the UserOperation is not yet included in a block, otherwise:

- `userOperation`: The full UserOperation
- `entryPoint`: The EntryPoint address
- `blockNumber`: The block number this UserOperation was included in
- `blockHash`: The block hash this UserOperation was included in
- `transactionHash` The transaction this UserOperation was included in

---

### Get UserOperation receipt

Fetches the UserOperation receipt based on a given `userOpHash` returned from `eth_sendUserOperation`.

#### Request

```typescript
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "eth_getUserOperationReceipt",
  "params": [userOpHash]
}
```

#### Response

The method returns `null` if the UserOperation is not yet included in a block, otherwise:

- `userOpHash`: The request hash
- `entryPoint`: The EntryPoint address
- `sender`: The contract account address
- `nonce`: The nonce for this UserOperation
- `paymaster`: The paymaster address used to sponsor gas (if used, otherwise empty)
- `actualGasCost`: The actual amount paid (by account or paymaster) for this UserOperation
- `actualGasUsed`: The total gas used by this UserOperation
- `success`: A boolean value indicating if this execution completed without revert
- `reason`: If revert occurred, this is the reason
- `logs`: The logs generated by this UserOperation only
- `receipt`: the `TransactionReceipt` object. This will be for the entire bundle, not only for this UserOperation.

---

### Supported EntryPoints

Returns an array of supported [EntryPoint](../../introduction/erc-4337-overview.md#entrypoint) addresses as specified in the [configuration](./configure.md). The first element is the bundler's preferred EntryPoint.

#### Request

```typescript
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "eth_supportedEntryPoints",
  "params": []
}
```

#### Response

```typescript
{
  "jsonrpc": "2.0",
  "id": 1,

  // EntryPoint addresses
  "result": [
    "0x...",
    "0x..."
  ]
}
```

---

## JSON-RPC errors

All error responses have the following format:

```typescript
{
  "jsonrpc": "2.0",
  "id": 1
  "error": {
    code,
    message
  }
}
```

Below are the common error codes specified by the protocol. These are in addition to the standard JSON-RPC error codes returned by a bad method call.

| Code   | Description                                                                                                                         |
| ------ | ----------------------------------------------------------------------------------------------------------------------------------- |
| -32602 | Invalid UserOperation struct/fields                                                                                                 |
| -32500 | Transaction rejected by entryPoint's simulateValidation, during account creation or validation                                      |
| -32501 | Transaction rejected by paymaster's `validatePaymasterUserOp`                                                                       |
| -32502 | Transaction rejected because of opcode validation                                                                                   |
| -32503 | UserOperation out of time-range: either account or paymaster returned a time-range, and it is already expired (or will expire soon) |
| -32504 | Transaction rejected because paymaster (or signature aggregator) is throttled/banned                                                |
| -32505 | Transaction rejected because paymaster (or signature aggregator) stake or unstake-delay is too low                                  |
| -32506 | Transaction rejected because account specified unsupported signature aggregator                                                     |
